<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–æ–≤–µ –∑–∞ Math Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ccc;
            background: #f9f9f9;
        }
        .test-case.pass {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .test-case.fail {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .test-result {
            font-size: 0.9em;
            color: #666;
        }
        .summary {
            padding: 15px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .error-detail {
            color: #721c24;
            font-family: monospace;
            font-size: 0.85em;
            margin-top: 5px;
            padding: 5px;
            background: #fff;
            border-radius: 4px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç–æ–≤–µ –∑–∞ Math Game (–°—ä–±–∏—Ä–∞–Ω–µ –∏ –∏–∑–≤–∞–∂–¥–∞–Ω–µ)</h1>
    
    <div id="summary" class="summary">
        <div>–ù–∞—Ç–∏—Å–Ω–∏ "–°—Ç–∞—Ä—Ç–∏—Ä–∞–π —Ç–µ—Å—Ç–æ–≤–µ" –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—à</div>
    </div>
    
    <button onclick="runAllTests()">–°—Ç–∞—Ä—Ç–∏—Ä–∞–π —Ç–µ—Å—Ç–æ–≤–µ</button>
    <button onclick="runSpecificTest('buildProblemUI')">–¢–µ—Å—Ç buildProblemUI()</button>
    <button onclick="runSpecificTest('generateProblem')">–¢–µ—Å—Ç generateProblem()</button>
    <button onclick="runSpecificTest('checkAnswer')">–¢–µ—Å—Ç checkAnswer()</button>
    <button onclick="runSpecificTest('selectCell')">–¢–µ—Å—Ç selectCell()</button>
    <button onclick="runSpecificTest('groupManager')">–¢–µ—Å—Ç GroupManager & Share</button>
    <button onclick="runSpecificTest('timestamp')">–¢–µ—Å—Ç Timestamp Display</button>
    
    <div id="test-results"></div>

    <!-- Load the app.js to access SubtractionGame class -->
    <script src="app.js"></script>
    
    <script>
        let testResults = [];
        
        function assert(condition, message) {
            if (!condition) {
                throw new Error(message);
            }
        }
        
        function assertEqual(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(`${message}\n–û—á–∞–∫–≤–∞–Ω–æ: ${expected}\n–ü–æ–ª—É—á–µ–Ω–æ: ${actual}`);
            }
        }
        
        function assertArrayEqual(actual, expected, message) {
            if (JSON.stringify(actual) !== JSON.stringify(expected)) {
                throw new Error(`${message}\n–û—á–∞–∫–≤–∞–Ω–æ: ${JSON.stringify(expected)}\n–ü–æ–ª—É—á–µ–Ω–æ: ${JSON.stringify(actual)}`);
            }
        }
        
        function createMockGameManager() {
            return {
                showGameSelection: () => {},
                showSubtractionSetup: () => {}
            };
        }
        
        function createTestHTML() {
            // Create minimal HTML structure needed for tests
            const container = document.createElement('div');
            container.innerHTML = `
                <div id="subtractionSetupScreen" class="hidden">
                    <input id="playerNameSubtraction" value="Test Player">
                    <button id="startSubtractionBtn"></button>
                    <button class="difficulty-btn" data-difficulty="easy">–õ–µ—Å–Ω–æ</button>
                    <button class="difficulty-btn selected" data-difficulty="medium">–°—Ä–µ–¥–Ω–æ</button>
                    <button class="difficulty-btn" data-difficulty="hard">–¢—Ä—É–¥–Ω–æ</button>
                    <button class="digits-btn selected" data-digits="2">2</button>
                    <button class="digits-btn" data-digits="3">3</button>
                    <button class="digits-btn" data-digits="4">4</button>
                    <button class="digits-btn" data-digits="5">5</button>
                    <button class="questions-btn" data-questions="10">10</button>
                    <button class="questions-btn selected" data-questions="20">20</button>
                    <button class="questions-btn" data-questions="30">30</button>
                    <button class="questions-btn" data-questions="50">50</button>
                    <button class="operation-btn selected" data-operation="addition">+</button>
                    <button class="operation-btn selected" data-operation="subtraction">-</button>
                    <span id="easyTimeLabel"></span>
                    <span id="mediumTimeLabel"></span>
                    <span id="hardTimeLabel"></span>
                    <button class="back-btn"></button>
                </div>
                <div id="subtractionGameScreen" class="hidden">
                    <span id="subQuestionNum">1</span>
                    <span id="subTotalQuestions">20</span>
                    <span id="subMaxScore">200</span>
                    <span id="subCurrentScore">0</span>
                    <span id="subGameTime">0:00</span>
                    <div class="subtraction-problem"></div>
                    <button class="num-btn" data-num="0">0</button>
                    <button class="num-btn" data-num="1">1</button>
                    <button class="num-btn" data-num="2">2</button>
                    <button class="num-btn" data-num="3">3</button>
                    <button class="num-btn" data-num="4">4</button>
                    <button class="num-btn" data-num="5">5</button>
                    <button class="num-btn" data-num="6">6</button>
                    <button class="num-btn" data-num="7">7</button>
                    <button class="num-btn" data-num="8">8</button>
                    <button class="num-btn" data-num="9">9</button>
                    <button id="subContinueBtn"></button>
                    <div id="subFeedback" class="hidden"></div>
                    <div id="subTasksBar"></div>
                    <div id="subPointsEarnedBar"></div>
                    <div id="subPointsPossibleBar"></div>
                    <div id="subQuestionProgressBar"></div>
                    <span id="subQuestionPointsLabel"></span>
                </div>
                <div id="subtractionResultsScreen" class="hidden">
                    <span id="subFinalScore">0</span>
                    <span id="subFinalTime">0:00</span>
                    <span id="subScorePerMinute">0</span>
                    <div id="subLeaderboardList"></div>
                    <span id="subLeaderboardDifficulty"></span>
                    <button id="subtractionPlayAgainBtn"></button>
                    <button class="back-btn"></button>
                </div>
            `;
            document.body.appendChild(container);
        }
        
        function cleanupTestHTML() {
            const elements = [
                'subtractionSetupScreen',
                'subtractionGameScreen',
                'subtractionResultsScreen'
            ];
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.parentElement) {
                    el.parentElement.remove();
                }
            });
        }
        
        // TEST 1: buildProblemUI() creates correct number of elements
        function test_buildProblemUI_creates_correct_elements() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            
            // Test for 2 digits
            game.numDigits = 2;
            game.buildProblemUI();
            
            for (let i = 0; i < 2; i++) {
                assert(document.getElementById(`num1Digit${i}`), `num1Digit${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 2 —Ü–∏—Ñ—Ä–∏`);
                assert(document.getElementById(`num2Digit${i}`), `num2Digit${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 2 —Ü–∏—Ñ—Ä–∏`);
                assert(document.getElementById(`answerDigit${i}`), `answerDigit${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 2 —Ü–∏—Ñ—Ä–∏`);
            }
            assert(document.getElementById('carry0'), 'carry0 —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 2 —Ü–∏—Ñ—Ä–∏');
            
            // Test for 5 digits
            game.numDigits = 5;
            game.buildProblemUI();
            
            for (let i = 0; i < 5; i++) {
                assert(document.getElementById(`num1Digit${i}`), `num1Digit${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 5 —Ü–∏—Ñ—Ä–∏`);
                assert(document.getElementById(`num2Digit${i}`), `num2Digit${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 5 —Ü–∏—Ñ—Ä–∏`);
                assert(document.getElementById(`answerDigit${i}`), `answerDigit${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 5 —Ü–∏—Ñ—Ä–∏`);
            }
            for (let i = 0; i < 4; i++) {
                assert(document.getElementById(`carry${i}`), `carry${i} —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∑–∞ 5 —Ü–∏—Ñ—Ä–∏`);
            }
            
            cleanupTestHTML();
        }
        
        // TEST 2: generateProblem() produces valid addition problems
        function test_generateProblem_addition_with_carry() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            
            // Test multiple generations
            for (let i = 0; i < 10; i++) {
                const problem = game.generateProblem('addition', true);
                
                assertEqual(problem.operation, 'addition', '–û–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ addition');
                assert(problem.num1 >= 10 && problem.num1 <= 99, 'num1 —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –¥–≤—É—Ü–∏—Ñ—Ä–µ–Ω–æ');
                assert(problem.num2 >= 10 && problem.num2 <= 99, 'num2 —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –¥–≤—É—Ü–∏—Ñ—Ä–µ–Ω–æ');
                
                // Check if carry is actually needed
                const ones1 = problem.num1 % 10;
                const ones2 = problem.num2 % 10;
                assert(ones1 + ones2 >= 10, `–° carry: ${problem.num1} + ${problem.num2} —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –Ω–æ—Å–µ–Ω–µ –≤ –µ–¥–∏–Ω–∏—Ü–∏—Ç–µ`);
            }
            
            cleanupTestHTML();
        }
        
        // TEST 3: generateProblem() produces valid addition without carry
        function test_generateProblem_addition_without_carry() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            
            for (let i = 0; i < 10; i++) {
                const problem = game.generateProblem('addition', false);
                
                assertEqual(problem.operation, 'addition', '–û–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ addition');
                
                // Check no carry in any position
                const ones1 = problem.num1 % 10;
                const ones2 = problem.num2 % 10;
                assert(ones1 + ones2 < 10, `–ë–µ–∑ carry: ${problem.num1} + ${problem.num2} –Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –Ω–æ—Å–µ–Ω–µ –≤ –µ–¥–∏–Ω–∏—Ü–∏—Ç–µ`);
            }
            
            cleanupTestHTML();
        }
        
        // TEST 4: generateProblem() produces valid subtraction with borrow
        function test_generateProblem_subtraction_with_borrow() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            
            for (let i = 0; i < 10; i++) {
                const problem = game.generateProblem('subtraction', true);
                
                assertEqual(problem.operation, 'subtraction', '–û–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ subtraction');
                assert(problem.num1 > problem.num2, `${problem.num1} —Ç—Ä—è–±–≤–∞ –¥–∞ –µ > ${problem.num2}`);
                
                // Check if borrow is needed
                const ones1 = problem.num1 % 10;
                const ones2 = problem.num2 % 10;
                assert(ones1 < ones2, `–° borrow: ${problem.num1} - ${problem.num2} —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –∑–∞–µ–º–∞–Ω–µ –≤ –µ–¥–∏–Ω–∏—Ü–∏—Ç–µ`);
            }
            
            cleanupTestHTML();
        }
        
        // TEST 5: generateProblem() produces valid subtraction without borrow
        function test_generateProblem_subtraction_without_borrow() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            
            for (let i = 0; i < 10; i++) {
                const problem = game.generateProblem('subtraction', false);
                
                assertEqual(problem.operation, 'subtraction', '–û–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ subtraction');
                assert(problem.num1 >= problem.num2, `${problem.num1} —Ç—Ä—è–±–≤–∞ –¥–∞ –µ >= ${problem.num2}`);
                
                // Check no borrow in any position
                const ones1 = problem.num1 % 10;
                const ones2 = problem.num2 % 10;
                assert(ones1 >= ones2, `–ë–µ–∑ borrow: ${problem.num1} - ${problem.num2} –Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –∑–∞–µ–º–∞–Ω–µ –≤ –µ–¥–∏–Ω–∏—Ü–∏—Ç–µ`);
            }
            
            cleanupTestHTML();
        }
        
        // TEST 6: generateProblem() works for different digit counts
        function test_generateProblem_multiple_digits() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            
            const digitCounts = [2, 3, 4, 5];
            
            for (const numDigits of digitCounts) {
                game.numDigits = numDigits;
                const min = Math.pow(10, numDigits - 1);
                const max = Math.pow(10, numDigits) - 1;
                
                const problem = game.generateProblem('addition', true);
                assert(problem.num1 >= min && problem.num1 <= max, 
                    `–ó–∞ ${numDigits} —Ü–∏—Ñ—Ä–∏, num1 (${problem.num1}) —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –º–µ–∂–¥—É ${min} –∏ ${max}`);
                assert(problem.num2 >= min && problem.num2 <= max,
                    `–ó–∞ ${numDigits} —Ü–∏—Ñ—Ä–∏, num2 (${problem.num2}) —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –º–µ–∂–¥—É ${min} –∏ ${max}`);
            }
            
            cleanupTestHTML();
        }
        
        // TEST 7: selectCell() updates selected state correctly
        function test_selectCell_updates_selection() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 3;
            game.buildProblemUI();
            
            // Select digit 0 (ones)
            game.selectCell(0);
            assertEqual(game.selectedCell, 0, 'selectedCell —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 0');
            assert(document.getElementById('answerDigit0').classList.contains('selected'), 
                'answerDigit0 —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ selected class');
            assert(!document.getElementById('answerDigit1').classList.contains('selected'),
                'answerDigit1 –ù–ï —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ selected class');
            
            // Select digit 2 (hundreds)
            game.selectCell(2);
            assertEqual(game.selectedCell, 2, 'selectedCell —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 2');
            assert(document.getElementById('answerDigit2').classList.contains('selected'),
                'answerDigit2 —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ selected class');
            assert(!document.getElementById('answerDigit0').classList.contains('selected'),
                'answerDigit0 –ù–ï —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ selected class —Å–ª–µ–¥ —Å–º—è–Ω–∞');
            
            cleanupTestHTML();
        }
        
        // TEST 8: handleNumberClick() fills cell and auto-switches
        function test_handleNumberClick_fills_and_switches() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 3;
            game.buildProblemUI();
            
            // Start with rightmost digit (position 2 = ones for 3-digit)
            game.selectCell(2);
            
            // Enter number 5
            game.handleNumberClick('5');
            
            const cell2 = document.getElementById('answerDigit2');
            assertEqual(cell2.dataset.value, '5', 'answerDigit2 —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ value 5');
            assertEqual(cell2.innerHTML, '<span class="answer-value">5</span>', 'answerDigit2 —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∑–≤–∞ 5');
            
            // Should auto-switch to digit 1 (tens)
            assertEqual(game.selectedCell, 1, '–¢—Ä—è–±–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–∞ –ø—Ä–µ–º–∏–Ω–µ –∫—ä–º –ø–æ–∑–∏—Ü–∏—è 1');
            
            // Enter number 3
            game.handleNumberClick('3');
            assertEqual(document.getElementById('answerDigit1').dataset.value, '3', 'answerDigit1 —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ value 3');
            
            // Should auto-switch to digit 0 (hundreds)
            assertEqual(game.selectedCell, 0, '–¢—Ä—è–±–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–∞ –ø—Ä–µ–º–∏–Ω–µ –∫—ä–º –ø–æ–∑–∏—Ü–∏—è 0');
            
            cleanupTestHTML();
        }
        
        // TEST 9: toggleCarry() toggles carry state
        function test_toggleCarry_toggles_state() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 3;
            game.buildProblemUI();
            game.carryStates = [false, false]; // 2 carry positions for 3 digits
            
            // Toggle carry at position 0
            game.toggleCarry(0);
            assertEqual(game.carryStates[0], true, 'carryStates[0] —Ç—Ä—è–±–≤–∞ –¥–∞ –µ true —Å–ª–µ–¥ toggle');
            assert(document.getElementById('carry0').classList.contains('active'),
                'carry0 —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ active class');
            
            // Toggle again
            game.toggleCarry(0);
            assertEqual(game.carryStates[0], false, 'carryStates[0] —Ç—Ä—è–±–≤–∞ –¥–∞ –µ false —Å–ª–µ–¥ –≤—Ç–æ—Ä–∏ toggle');
            assert(!document.getElementById('carry0').classList.contains('active'),
                'carry0 –ù–ï —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ active class —Å–ª–µ–¥ –≤—Ç–æ—Ä–∏ toggle');
            
            cleanupTestHTML();
        }
        
        // TEST 10: getTimeForDifficulty() calculates correct time
        function test_getTimeForDifficulty_calculation() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            
            // Test for 2 digits (base time)
            game.numDigits = 2;
            game.difficulty = 'easy';
            assertEqual(game.getTimeForDifficulty(), 18, 'Easy 2 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 18s');
            
            game.difficulty = 'medium';
            assertEqual(game.getTimeForDifficulty(), 12, 'Medium 2 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 12s');
            
            game.difficulty = 'hard';
            assertEqual(game.getTimeForDifficulty(), 6, 'Hard 2 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 6s');
            
            // Test for 3 digits (base + extra)
            game.numDigits = 3;
            game.difficulty = 'easy';
            assertEqual(game.getTimeForDifficulty(), 26, 'Easy 3 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 26s (18 + 8)');
            
            game.difficulty = 'medium';
            assertEqual(game.getTimeForDifficulty(), 16, 'Medium 3 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 16s (12 + 4)');
            
            game.difficulty = 'hard';
            assertEqual(game.getTimeForDifficulty(), 8, 'Hard 3 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 8s (6 + 2)');
            
            // Test for 5 digits
            game.numDigits = 5;
            game.difficulty = 'easy';
            assertEqual(game.getTimeForDifficulty(), 42, 'Easy 5 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 42s (18 + 3*8)');
            
            cleanupTestHTML();
        }
        
        // TEST 11: checkAnswer() validates correct addition answer
        function test_checkAnswer_addition_correct() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            game.buildProblemUI();
            
            // Create a known problem: 45 + 27 = 72 (with carry)
            game.questions = [{
                operation: 'addition',
                num1: 45,
                num2: 27
            }];
            game.currentQuestion = 1;
            game.questionStartTime = Date.now() - 1000; // 1 second ago
            game.carryStates = [true]; // Mark carry as checked
            
            // Fill answer: 72
            document.getElementById('answerDigit0').dataset.value = '7'; // tens
            document.getElementById('answerDigit1').dataset.value = '2'; // ones
            
            // Mock stopQuestionTimer
            game.stopQuestionTimer = () => {};
            
            // Check answer (we'll intercept the result via feedback)
            const originalCalculatePoints = game.calculatePoints;
            let pointsCalculated = null;
            game.calculatePoints = (elapsed) => {
                pointsCalculated = originalCalculatePoints.call(game, elapsed);
                return pointsCalculated;
            };
            
            // We can't fully test checkAnswer without mocking more, but we can test the logic
            const questionData = game.questions[0];
            const correctResult = questionData.num1 + questionData.num2;
            assertEqual(correctResult, 72, '–†–µ–∑—É–ª—Ç–∞—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 72');
            
            // Check carry logic
            const ones1 = 45 % 10; // 5
            const ones2 = 27 % 10; // 7
            assert(ones1 + ones2 >= 10, '–¢—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ carry (5 + 7 = 12)');
            
            cleanupTestHTML();
        }
        
        // TEST 12: checkAnswer() validates correct subtraction answer
        function test_checkAnswer_subtraction_correct() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            game.buildProblemUI();
            
            // Create a known problem: 52 - 37 = 15 (with borrow)
            game.questions = [{
                operation: 'subtraction',
                num1: 52,
                num2: 37
            }];
            game.currentQuestion = 1;
            game.carryStates = [true]; // Mark borrow as checked
            
            // Fill answer: 15
            document.getElementById('answerDigit0').dataset.value = '1'; // tens
            document.getElementById('answerDigit1').dataset.value = '5'; // ones
            
            const questionData = game.questions[0];
            const correctResult = questionData.num1 - questionData.num2;
            assertEqual(correctResult, 15, '–†–µ–∑—É–ª—Ç–∞—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 15');
            
            // Check borrow logic
            const ones1 = 52 % 10; // 2
            const ones2 = 37 % 10; // 7
            assert(ones1 < ones2, '–¢—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ borrow (2 < 7)');
            
            cleanupTestHTML();
        }
        
        // TEST 13: carryStates array initialization
        function test_carryStates_initialization() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            
            assert(Array.isArray(game.carryStates), 'carryStates —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –º–∞—Å–∏–≤');
            
            // After buildProblemUI with different digits
            game.numDigits = 2;
            game.buildProblemUI();
            game.carryStates = new Array(game.numDigits - 1).fill(false);
            assertEqual(game.carryStates.length, 1, '–ó–∞ 2 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ 1 carry –ø–æ–∑–∏—Ü–∏—è');
            
            game.numDigits = 5;
            game.buildProblemUI();
            game.carryStates = new Array(game.numDigits - 1).fill(false);
            assertEqual(game.carryStates.length, 4, '–ó–∞ 5 —Ü–∏—Ñ—Ä–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ 4 carry –ø–æ–∑–∏—Ü–∏–∏');
            
            cleanupTestHTML();
        }
        
        // TEST 14: Leading zero validation in checkAnswer
        function test_checkAnswer_leading_zero_allowed() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 2;
            game.buildProblemUI();
            
            // Problem: 55 - 48 = 7 (single digit result)
            game.questions = [{
                operation: 'subtraction',
                num1: 55,
                num2: 48
            }];
            game.currentQuestion = 1;
            game.carryStates = [true];
            
            // Test case 1: Leave tens empty
            document.getElementById('answerDigit0').dataset.value = ''; // tens empty
            document.getElementById('answerDigit1').dataset.value = '7'; // ones
            
            const correctStr = '07';
            const userDigit0 = '';
            const userDigit1 = '7';
            
            // Leading zero should be allowed as empty
            const shouldAcceptEmpty = correctStr[0] === '0' && userDigit0 === '';
            assert(shouldAcceptEmpty, '–¢—Ä—è–±–≤–∞ –¥–∞ –ø—Ä–∏–µ–º–∞ –ø—Ä–∞–∑–Ω–∞ –≤–æ–¥–µ—â–∞ –Ω—É–ª–∞');
            
            // Test case 2: Enter '0' for tens
            document.getElementById('answerDigit0').dataset.value = '0';
            const shouldAcceptZero = correctStr[0] === '0' && (userDigit0 === '' || userDigit0 === '0');
            assert(shouldAcceptZero, '–¢—Ä—è–±–≤–∞ –¥–∞ –ø—Ä–∏–µ–º–∞ "0" –∫–∞—Ç–æ –≤–æ–¥–µ—â–∞ –Ω—É–ª–∞');
            
            cleanupTestHTML();
        }
        
        // TEST 15: Multi-digit carry detection
        function test_multi_digit_carry_detection() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            game.numDigits = 3;
            
            // Test problem: 456 + 789 = 1245 (carry in first and second positions)
            const num1 = 456;
            const num2 = 789;
            const operation = 'addition';
            
            const num1Str = num1.toString().padStart(3, '0'); // "456"
            const num2Str = num2.toString().padStart(3, '0'); // "789"
            const needsCarry = new Array(2).fill(false);
            
            // Simulate carry detection logic
            let carry = 0;
            for (let i = 2; i > 0; i--) { // Right to left (ones, then tens)
                const d1 = parseInt(num1Str[i]);
                const d2 = parseInt(num2Str[i]);
                const sum = d1 + d2 + carry;
                carry = sum >= 10 ? 1 : 0;
                if (carry === 1) {
                    needsCarry[i - 1] = true;
                }
            }
            
            // Position 1 (tens place): 5 + 8 + 1(carry) = 14, generates carry
            // Position 0 (hundreds place): 4 + 7 + 1(carry) = 12, generates carry
            assertArrayEqual(needsCarry, [true, true], '–ò –¥–≤–µ—Ç–µ –ø–æ–∑–∏—Ü–∏–∏ —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞—Ç carry');
            
            cleanupTestHTML();
        }
        
        // TEST 16: GroupManager generates valid group IDs
        function test_groupManager_generates_valid_ids() {
            const manager = window.groupManager || new GroupManager();
            
            // Generate multiple IDs and check uniqueness
            const ids = new Set();
            for (let i = 0; i < 10; i++) {
                const id = manager.generateGroupId();
                assert(typeof id === 'string', 'Group ID —Ç—Ä—è–±–≤–∞ –¥–∞ –µ string');
                assert(id.length === 8, `Group ID —Ç—Ä—è–±–≤–∞ –¥–∞ –µ 8 —Å–∏–º–≤–æ–ª–∞, –ø–æ–ª—É—á–µ–Ω–æ: ${id.length}`);
                assert(/^[a-z0-9]+$/.test(id), `Group ID —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞ —Å–∞–º–æ –±—É–∫–≤–∏ –∏ —Ü–∏—Ñ—Ä–∏: ${id}`);
                ids.add(id);
            }
            assertEqual(ids.size, 10, '–í—Å–∏—á–∫–∏ 10 ID —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–∞ —É–Ω–∏–∫–∞–ª–Ω–∏');
        }
        
        // TEST 17: GroupManager reads URL parameters correctly
        function test_groupManager_reads_url_params() {
            const manager = window.groupManager || new GroupManager();
            
            // Mock window.location
            const originalLocation = window.location;
            delete window.location;
            window.location = { search: '?group=test1234' };
            
            const groupId = manager.getGroupIdFromUrl();
            assertEqual(groupId, 'test1234', '–¢—Ä—è–±–≤–∞ –¥–∞ –ø—Ä–æ—á–µ—Ç–µ group ID –æ—Ç URL');
            
            // Restore
            window.location = originalLocation;
        }
        
        // TEST 18: GroupManager generates share URL correctly
        function test_groupManager_generates_share_url() {
            const manager = window.groupManager || new GroupManager();
            
            const testGroupId = 'abc12345';
            const shareUrl = manager.getShareUrl(testGroupId);
            
            assert(shareUrl.includes('?group='), 'Share URL —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞ ?group=');
            assert(shareUrl.includes(testGroupId), `Share URL —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä–¥—ä—Ä–∂–∞ group ID: ${testGroupId}`);
            assert(shareUrl.startsWith('http'), 'Share URL —Ç—Ä—è–±–≤–∞ –¥–∞ –∑–∞–ø–æ—á–≤–∞ —Å http');
        }
        
        // TEST 19: formatTimeAgo displays correct text for today
        function test_formatTimeAgo_today() {
            // Mock formatTimeAgo if not available globally
            const formatTimeAgo = window.formatTimeAgo || function(timestamp) {
                const now = Date.now();
                const diffMs = now - timestamp;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return '–¥–Ω–µ—Å';
                if (diffDays === 1) return '–ø—Ä–µ–¥–∏ 1 –¥–µ–Ω';
                return `–ø—Ä–µ–¥–∏ ${diffDays} –¥–Ω–∏`;
            };
            
            const now = Date.now();
            const result = formatTimeAgo(now);
            assertEqual(result, '–¥–Ω–µ—Å', '–†–µ–∑—É–ª—Ç–∞—Ç –æ—Ç –¥–Ω–µ—Å —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∑–≤–∞ "–¥–Ω–µ—Å"');
            
            // Test 2 hours ago
            const twoHoursAgo = now - (2 * 60 * 60 * 1000);
            const result2 = formatTimeAgo(twoHoursAgo);
            assertEqual(result2, '–¥–Ω–µ—Å', '2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∑–≤–∞ "–¥–Ω–µ—Å"');
        }
        
        // TEST 20: formatTimeAgo displays correct text for days ago
        function test_formatTimeAgo_days_ago() {
            const formatTimeAgo = window.formatTimeAgo || function(timestamp) {
                const now = Date.now();
                const diffMs = now - timestamp;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return '–¥–Ω–µ—Å';
                if (diffDays === 1) return '–ø—Ä–µ–¥–∏ 1 –¥–µ–Ω';
                return `–ø—Ä–µ–¥–∏ ${diffDays} –¥–Ω–∏`;
            };
            
            const now = Date.now();
            
            // Test 1 day ago
            const oneDayAgo = now - (25 * 60 * 60 * 1000);
            const result1 = formatTimeAgo(oneDayAgo);
            assertEqual(result1, '–ø—Ä–µ–¥–∏ 1 –¥–µ–Ω', '1 –¥–µ–Ω –Ω–∞–∑–∞–¥ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∑–≤–∞ "–ø—Ä–µ–¥–∏ 1 –¥–µ–Ω"');
            
            // Test 5 days ago
            const fiveDaysAgo = now - (5 * 24 * 60 * 60 * 1000);
            const result5 = formatTimeAgo(fiveDaysAgo);
            assertEqual(result5, '–ø—Ä–µ–¥–∏ 5 –¥–Ω–∏', '5 –¥–Ω–∏ –Ω–∞–∑–∞–¥ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∑–≤–∞ "–ø—Ä–µ–¥–∏ 5 –¥–Ω–∏"');
            
            // Test 30 days ago
            const thirtyDaysAgo = now - (30 * 24 * 60 * 60 * 1000);
            const result30 = formatTimeAgo(thirtyDaysAgo);
            assertEqual(result30, '–ø—Ä–µ–¥–∏ 30 –¥–Ω–∏', '30 –¥–Ω–∏ –Ω–∞–∑–∞–¥ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–∫–∞–∑–≤–∞ "–ø—Ä–µ–¥–∏ 30 –¥–Ω–∏"');
        }
        
        // TEST 21: Timestamp is included in leaderboard entries
        function test_timestamp_in_leaderboard_entry() {
            createTestHTML();
            const game = new SubtractionGame(createMockGameManager());
            
            // Create a mock leaderboard entry
            const entry = {
                name: 'Test Player',
                time: 120,
                timestamp: Date.now() - (2 * 24 * 60 * 60 * 1000) // 2 days ago
            };
            
            assert(entry.timestamp !== undefined, 'Leaderboard entry —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ timestamp');
            assert(typeof entry.timestamp === 'number', 'Timestamp —Ç—Ä—è–±–≤–∞ –¥–∞ –µ —á–∏—Å–ª–æ');
            assert(entry.timestamp > 0, 'Timestamp —Ç—Ä—è–±–≤–∞ –¥–∞ –µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª–Ω–æ —á–∏—Å–ª–æ');
            
            cleanupTestHTML();
        }
        
        // Run all tests
        function runAllTests() {
            testResults = [];
            const tests = [
                { name: 'buildProblemUI() —Å—ä–∑–¥–∞–≤–∞ –ø—Ä–∞–≤–∏–ª–µ–Ω –±—Ä–æ–π –µ–ª–µ–º–µ–Ω—Ç–∏', fn: test_buildProblemUI_creates_correct_elements, category: 'buildProblemUI' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Å—ä–±–∏—Ä–∞–Ω–µ —Å –Ω–æ—Å–µ–Ω–µ', fn: test_generateProblem_addition_with_carry, category: 'generateProblem' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Å—ä–±–∏—Ä–∞–Ω–µ –±–µ–∑ –Ω–æ—Å–µ–Ω–µ', fn: test_generateProblem_addition_without_carry, category: 'generateProblem' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ –∏–∑–≤–∞–∂–¥–∞–Ω–µ —Å—ä—Å –∑–∞–µ–º–∞–Ω–µ', fn: test_generateProblem_subtraction_with_borrow, category: 'generateProblem' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ –∏–∑–≤–∞–∂–¥–∞–Ω–µ –±–µ–∑ –∑–∞–µ–º–∞–Ω–µ', fn: test_generateProblem_subtraction_without_borrow, category: 'generateProblem' },
                { name: 'generateProblem() —Ä–∞–±–æ—Ç–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–µ–Ω –±—Ä–æ–π —Ü–∏—Ñ—Ä–∏', fn: test_generateProblem_multiple_digits, category: 'generateProblem' },
                { name: 'selectCell() –æ–±–Ω–æ–≤—è–≤–∞ –∏–∑–±—Ä–∞–Ω–∞—Ç–∞ –∫–ª–µ—Ç–∫–∞', fn: test_selectCell_updates_selection, category: 'selectCell' },
                { name: 'handleNumberClick() –ø–æ–ø—ä–ª–≤–∞ –∏ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞', fn: test_handleNumberClick_fills_and_switches, category: 'selectCell' },
                { name: 'toggleCarry() –ø—Ä–µ–≤–∫–ª—é—á–≤–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ', fn: test_toggleCarry_toggles_state, category: 'selectCell' },
                { name: 'getTimeForDifficulty() –∏–∑—á–∏—Å–ª—è–≤–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ –≤—Ä–µ–º–µ', fn: test_getTimeForDifficulty_calculation, category: 'other' },
                { name: 'checkAnswer() –≤–∞–ª–∏–¥–∏—Ä–∞ –≤–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –ø—Ä–∏ —Å—ä–±–∏—Ä–∞–Ω–µ', fn: test_checkAnswer_addition_correct, category: 'checkAnswer' },
                { name: 'checkAnswer() –≤–∞–ª–∏–¥–∏—Ä–∞ –≤–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –ø—Ä–∏ –∏–∑–≤–∞–∂–¥–∞–Ω–µ', fn: test_checkAnswer_subtraction_correct, category: 'checkAnswer' },
                { name: 'carryStates –º–∞—Å–∏–≤ —Å–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ', fn: test_carryStates_initialization, category: 'other' },
                { name: 'checkAnswer() –ø—Ä–∏–µ–º–∞ –ø—Ä–∞–∑–Ω–∞ –≤–æ–¥–µ—â–∞ –Ω—É–ª–∞', fn: test_checkAnswer_leading_zero_allowed, category: 'checkAnswer' },
                { name: '–î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞ –Ω–æ—Å–µ–Ω–µ –≤ –º–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–∏', fn: test_multi_digit_carry_detection, category: 'checkAnswer' },
                { name: 'GroupManager –≥–µ–Ω–µ—Ä–∏—Ä–∞ –≤–∞–ª–∏–¥–Ω–∏ group ID', fn: test_groupManager_generates_valid_ids, category: 'groupManager' },
                { name: 'GroupManager —á–µ—Ç–µ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–∞–≤–∏–ª–Ω–æ', fn: test_groupManager_reads_url_params, category: 'groupManager' },
                { name: 'GroupManager –≥–µ–Ω–µ—Ä–∏—Ä–∞ share URL –ø—Ä–∞–≤–∏–ª–Ω–æ', fn: test_groupManager_generates_share_url, category: 'groupManager' },
                { name: 'formatTimeAgo() –ø–æ–∫–∞–∑–≤–∞ "–¥–Ω–µ—Å" –ø—Ä–∞–≤–∏–ª–Ω–æ', fn: test_formatTimeAgo_today, category: 'timestamp' },
                { name: 'formatTimeAgo() –ø–æ–∫–∞–∑–≤–∞ "–ø—Ä–µ–¥–∏ X –¥–Ω–∏" –ø—Ä–∞–≤–∏–ª–Ω–æ', fn: test_formatTimeAgo_days_ago, category: 'timestamp' },
                { name: 'Timestamp —Å–µ –≤–∫–ª—é—á–≤–∞ –≤ leaderboard entries', fn: test_timestamp_in_leaderboard_entry, category: 'timestamp' }
            ];
            
            let passed = 0;
            let failed = 0;
            
            tests.forEach(test => {
                try {
                    test.fn();
                    testResults.push({ name: test.name, passed: true, category: test.category });
                    passed++;
                } catch (error) {
                    testResults.push({ name: test.name, passed: false, error: error.message, category: test.category });
                    failed++;
                }
            });
            
            displayResults(passed, failed);
        }
        
        function runSpecificTest(category) {
            testResults = [];
            const allTests = [
                { name: 'buildProblemUI() —Å—ä–∑–¥–∞–≤–∞ –ø—Ä–∞–≤–∏–ª–µ–Ω –±—Ä–æ–π –µ–ª–µ–º–µ–Ω—Ç–∏', fn: test_buildProblemUI_creates_correct_elements, category: 'buildProblemUI' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Å—ä–±–∏—Ä–∞–Ω–µ —Å –Ω–æ—Å–µ–Ω–µ', fn: test_generateProblem_addition_with_carry, category: 'generateProblem' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ —Å—ä–±–∏—Ä–∞–Ω–µ –±–µ–∑ –Ω–æ—Å–µ–Ω–µ', fn: test_generateProblem_addition_without_carry, category: 'generateProblem' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ –∏–∑–≤–∞–∂–¥–∞–Ω–µ —Å—ä—Å –∑–∞–µ–º–∞–Ω–µ', fn: test_generateProblem_subtraction_with_borrow, category: 'generateProblem' },
                { name: 'generateProblem() –≥–µ–Ω–µ—Ä–∏—Ä–∞ –∏–∑–≤–∞–∂–¥–∞–Ω–µ –±–µ–∑ –∑–∞–µ–º–∞–Ω–µ', fn: test_generateProblem_subtraction_without_borrow, category: 'generateProblem' },
                { name: 'generateProblem() —Ä–∞–±–æ—Ç–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–µ–Ω –±—Ä–æ–π —Ü–∏—Ñ—Ä–∏', fn: test_generateProblem_multiple_digits, category: 'generateProblem' },
                { name: 'selectCell() –æ–±–Ω–æ–≤—è–≤–∞ –∏–∑–±—Ä–∞–Ω–∞—Ç–∞ –∫–ª–µ—Ç–∫–∞', fn: test_selectCell_updates_selection, category: 'selectCell' },
                { name: 'handleNumberClick() –ø–æ–ø—ä–ª–≤–∞ –∏ –ø—Ä–µ–≤–∫–ª—é—á–≤–∞', fn: test_handleNumberClick_fills_and_switches, category: 'selectCell' },
                { name: 'toggleCarry() –ø—Ä–µ–≤–∫–ª—é—á–≤–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ', fn: test_toggleCarry_toggles_state, category: 'selectCell' },
                { name: 'getTimeForDifficulty() –∏–∑—á–∏—Å–ª—è–≤–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ –≤—Ä–µ–º–µ', fn: test_getTimeForDifficulty_calculation, category: 'other' },
                { name: 'checkAnswer() –≤–∞–ª–∏–¥–∏—Ä–∞ –≤–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –ø—Ä–∏ —Å—ä–±–∏—Ä–∞–Ω–µ', fn: test_checkAnswer_addition_correct, category: 'checkAnswer' },
                { name: 'checkAnswer() –≤–∞–ª–∏–¥–∏—Ä–∞ –≤–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä –ø—Ä–∏ –∏–∑–≤–∞–∂–¥–∞–Ω–µ', fn: test_checkAnswer_subtraction_correct, category: 'checkAnswer' },
                { name: 'carryStates –º–∞—Å–∏–≤ —Å–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ', fn: test_carryStates_initialization, category: 'other' },
                { name: 'checkAnswer() –ø—Ä–∏–µ–º–∞ –ø—Ä–∞–∑–Ω–∞ –≤–æ–¥–µ—â–∞ –Ω—É–ª–∞', fn: test_checkAnswer_leading_zero_allowed, category: 'checkAnswer' },
                { name: '–î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞ –Ω–æ—Å–µ–Ω–µ –≤ –º–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–∏', fn: test_multi_digit_carry_detection, category: 'checkAnswer' }
            ];
            
            const tests = allTests.filter(t => t.category === category);
            
            let passed = 0;
            let failed = 0;
            
            tests.forEach(test => {
                try {
                    test.fn();
                    testResults.push({ name: test.name, passed: true, category: test.category });
                    passed++;
                } catch (error) {
                    testResults.push({ name: test.name, passed: false, error: error.message, category: test.category });
                    failed++;
                }
            });
            
            displayResults(passed, failed);
        }
        
        function displayResults(passed, failed) {
            const total = passed + failed;
            const percentage = Math.round((passed / total) * 100);
            
            document.getElementById('summary').innerHTML = `
                <h2>–†–µ–∑—É–ª—Ç–∞—Ç–∏</h2>
                <div>–û–±—â–æ —Ç–µ—Å—Ç–æ–≤–µ: ${total}</div>
                <div>‚úÖ –£—Å–ø–µ—à–Ω–∏: ${passed}</div>
                <div>‚ùå –ù–µ—É—Å–ø–µ—à–Ω–∏: ${failed}</div>
                <div>–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç: ${percentage}%</div>
            `;
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            // Group by category
            const categories = {
                'buildProblemUI': [],
                'generateProblem': [],
                'selectCell': [],
                'checkAnswer': [],
                'groupManager': [],
                'timestamp': [],
                'other': []
            };
            
            testResults.forEach(result => {
                categories[result.category].push(result);
            });
            
            Object.keys(categories).forEach(category => {
                if (categories[category].length === 0) return;
                
                const section = document.createElement('div');
                section.className = 'test-section';
                
                const categoryNames = {
                    'buildProblemUI': 'buildProblemUI() - –î–∏–Ω–∞–º–∏—á–Ω–æ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ UI',
                    'generateProblem': 'generateProblem() - –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∏',
                    'selectCell': 'selectCell() & handleNumberClick() - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ',
                    'checkAnswer': 'checkAnswer() - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏',
                    'groupManager': 'GroupManager - –°–ø–æ–¥–µ–ª—è–Ω–µ –∏ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏',
                    'timestamp': 'Timestamp Display - –í—Ä–µ–º–µ–≤–∏ –º–∞—Ä–∫–µ—Ä–∏',
                    'other': '–î—Ä—É–≥–∏ –º–µ—Ç–æ–¥–∏'
                };
                
                section.innerHTML = `<h2>${categoryNames[category]}</h2>`;
                
                categories[category].forEach(result => {
                    const testCase = document.createElement('div');
                    testCase.className = `test-case ${result.passed ? 'pass' : 'fail'}`;
                    
                    const icon = result.passed ? '‚úÖ' : '‚ùå';
                    let html = `
                        <div class="test-name">${icon} ${result.name}</div>
                        <div class="test-result">${result.passed ? '–£–°–ü–ï–•' : '–ù–ï–£–°–ü–ï–•'}</div>
                    `;
                    
                    if (!result.passed && result.error) {
                        html += `<div class="error-detail">${result.error}</div>`;
                    }
                    
                    testCase.innerHTML = html;
                    section.appendChild(testCase);
                });
                
                resultsDiv.appendChild(section);
            });
        }
    </script>
</body>
</html>
