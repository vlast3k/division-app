<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ –∑–∞ –¥–µ–ª–∏—Ç–µ–ª–∏ üéÆ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Game Selection Screen -->
    <div id="gameSelectionScreen" class="screen">
        <div class="container">
            <h1>üéÆ –ò–∑–±–µ—Ä–∏ –∏–≥—Ä–∞</h1>
            
            <!-- Common player and group settings -->
            <div class="input-group">
                <label for="globalGroupId">–ì—Ä—É–ø–∞ (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏ –ø—Ä–∞–∑–Ω–æ):</label>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="globalGroupId" placeholder="–Ω–∞–ø—Ä: alpha-beta-42" maxlength="30" style="flex: 1;">
                    <button id="globalLoadGroupBtn" class="config-btn" style="padding: 8px 16px; white-space: nowrap;">üì• –ó–∞—Ä–µ–¥–∏</button>
                    <button id="globalShareGroupBtn" class="config-btn" style="padding: 8px 16px; white-space: nowrap;">üîó –°–ø–æ–¥–µ–ª–∏</button>
                </div>
                <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">üí° –ê–∫–æ –µ –ø—Ä–∞–∑–Ω–æ, —â–µ —Å–µ —Å—ä–∑–¥–∞–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ò–∑–ø–æ–ª–∑–≤–∞–π "–ó–∞—Ä–µ–¥–∏" –∑–∞ —Å–ø–∏—Å—ä–∫ —Å –∏–≥—Ä–∞—á–∏.</small>
            </div>
            
            <div class="input-group">
                <label for="globalPlayerName">–¢–≤–æ–µ—Ç–æ –∏–º–µ:</label>
                <input type="text" id="globalPlayerName" list="playerNamesList" placeholder="–ò–∑–±–µ—Ä–∏ –∏–ª–∏ –≤—ä–≤–µ–¥–∏ –∏–º–µ" maxlength="20" autocomplete="off">
                <datalist id="playerNamesList">
                </datalist>
                <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">üí° –ò–∑–±–µ—Ä–∏ –æ—Ç —Å–ø–∏—Å—ä–∫–∞ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ –Ω–æ–≤–æ –∏–º–µ</small>
            </div>
            
            <div class="game-selection">
                <button class="game-select-btn" id="selectDivisionGame">
                    <span class="game-title">–î–µ–ª–∏—Ç–µ–ª–∏ 3, 6, 9</span>
                    <span class="game-desc">–ù–∞–º–µ—Ä–∏ –Ω–∞–π-–≥–æ–ª–µ–º–∏—è –¥–µ–ª–∏—Ç–µ–ª</span>
                </button>
                <button class="game-select-btn" id="selectSubtractionGame">
                    <span class="game-title">–°—ä–±–∏—Ä–∞–Ω–µ –∏ –∏–∑–≤–∞–∂–¥–∞–Ω–µ</span>
                    <span class="game-desc">–ü—Ä–µ—Å–º—è—Ç–∞–π —á–∏—Å–ª–∞—Ç–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Division Game Setup Screen -->
    <div id="divisionSetupScreen" class="screen hidden">
        <div class="container">
            <h1>üéØ –ò–≥—Ä–∞ –∑–∞ –¥–µ–ª–∏—Ç–µ–ª–∏</h1>
            <p class="subtitle">–ò–∑–±–µ—Ä–∏ –Ω–∞–π-–≥–æ–ª–µ–º–∏—è –¥–µ–ª–∏—Ç–µ–ª: 3, 6 –∏–ª–∏ 9</p>
            
            <div class="config-group">
                <label>–ë—Ä–æ–π –∑–∞–¥–∞—á–∏:</label>
                <div class="config-buttons">
                    <button class="config-btn division-questions-btn" data-questions="10">10</button>
                    <button class="config-btn division-questions-btn" data-questions="20">20</button>
                </div>
            </div>
            
            <div class="difficulty-group">
                <label>–°–ª–æ–∂–Ω–æ—Å—Ç:</label>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn" data-difficulty="easy">
                        <span class="diff-name">–õ–ï–°–ù–û</span>
                        <span class="diff-time">15 —Å–µ–∫</span>
                    </button>
                    <button class="difficulty-btn" data-difficulty="medium">
                        <span class="diff-name">–°–†–ï–î–ù–û</span>
                        <span class="diff-time">10 —Å–µ–∫</span>
                    </button>
                    <button class="difficulty-btn" data-difficulty="hard">
                        <span class="diff-name">–¢–†–£–î–ù–û</span>
                        <span class="diff-time">6 —Å–µ–∫</span>
                    </button>
                </div>
            </div>
            <button id="startDivisionBtn" class="big-btn">–ó–∞–ø–æ—á–Ω–∏ –∏–≥—Ä–∞—Ç–∞!</button>
            <button id="viewDivisionLeaderboardBtn" class="big-btn secondary-btn">üèÜ Leaderboard</button>
            <button class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="rules">
                <h3>üìú –ü—Ä–∞–≤–∏–ª–∞:</h3>
                <ul>
                    <li>–ò–∑–±–µ—Ä–∏ –±—Ä–æ–π –∑–∞–¥–∞—á–∏ (10 –∏–ª–∏ 20)</li>
                    <li>–ò–∑–±–µ—Ä–∏ <strong>–Ω–∞–π-–≥–æ–ª–µ–º–∏—è</strong> –¥–µ–ª–∏—Ç–µ–ª: 3, 6, 9 –∏–ª–∏ "–î—Ä—É–≥–æ"</li>
                    <li>–í—Å—è–∫–∞ –∑–∞–¥–∞—á–∞: –º–∞–∫—Å 10 —Ç–æ—á–∫–∏</li>
                    <li>–ö–æ–ª–∫–æ—Ç–æ –ø–æ-–±—ä—Ä–∑–æ –æ—Ç–≥–æ–≤–æ—Ä–∏—à, —Ç–æ–ª–∫–æ–≤–∞ –ø–æ–≤–µ—á–µ —Ç–æ—á–∫–∏!</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Division Game Screen -->
    <div id="divisionGameScreen" class="screen hidden">
        <div class="game-container">
            <div class="question-card">
                <div class="header-progress">
                    <div class="progress-section">
                        <div class="progress-label">–ó–∞–¥–∞—á–∏: <span id="questionNum">1</span>/<span id="divTotalQuestions">20</span></div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar tasks-bar" id="tasksBar"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">–¢–æ—á–∫–∏: <span id="currentScore">0</span>/<span id="divMaxScore">200</span></div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar points-possible-bar" id="pointsPossibleBar"></div>
                            <div class="progress-bar points-earned-bar" id="pointsEarnedBar"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label-inline">
                            <span>–í—Ä–µ–º–µ –∑–∞ –∑–∞–¥–∞—á–∞:</span>
                            <span class="question-points-label">10—Ç</span>
                        </div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar question-progress-bar"></div>
                        </div>
                    </div>
                </div>
                
                <div class="timer-display">–û–±—â–æ –≤—Ä–µ–º–µ: <span id="gameTime">0:00</span></div>
                
                <div class="number-display" id="numberDisplay">?</div>
                <p class="question-text">–ò–∑–±–µ—Ä–∏ <strong>–Ω–∞–π-–≥–æ–ª–µ–º–∏—è</strong> –¥–µ–ª–∏—Ç–µ–ª:</p>
                <div class="answer-buttons">
                    <button class="answer-btn" data-answer="3">3</button>
                    <button class="answer-btn" data-answer="6">6</button>
                    <button class="answer-btn" data-answer="9">9</button>
                    <button class="answer-btn other-btn" data-answer="other">–î—Ä—É–≥–æ</button>
                </div>
            </div>
            <div class="feedback hidden" id="feedback"></div>
        </div>
    </div>

    <!-- Division Results Screen -->
    <div id="divisionResultsScreen" class="screen hidden">
        <div class="container">
            <h1>üéâ –ë—Ä–∞–≤–æ!</h1>
            <div class="final-results">
                <div class="stat-box">
                    <div class="stat-label">–§–∏–Ω–∞–ª–Ω–∏ —Ç–æ—á–∫–∏</div>
                    <div class="stat-value" id="finalScore">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">–í—Ä–µ–º–µ</div>
                    <div class="stat-value" id="finalTime">0:00</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">–¢–æ—á–∫–∏/–º–∏–Ω—É—Ç–∞</div>
                    <div class="stat-value" id="scorePerMinute">0</div>
                </div>
            </div>
            
            <div class="leaderboard">
                <h2>üèÜ –ö–ª–∞—Å–∞—Ü–∏—è - <span id="leaderboardDifficulty"></span></h2>
                <div id="leaderboardList"></div>
            </div>
            
            <button id="divisionPlayAgainBtn" class="big-btn">–ò–≥—Ä–∞–π –æ—Ç–Ω–æ–≤–æ!</button>
            <button id="divisionBackToSetupBtn" class="big-btn secondary-btn">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º –∏–≥—Ä–∏</button>
        </div>
    </div>

    <!-- Subtraction Game Setup Screen -->
    <div id="subtractionSetupScreen" class="screen hidden">
        <div class="container">
            <h1>üî¢ –°—ä–±–∏—Ä–∞–Ω–µ –∏ –∏–∑–≤–∞–∂–¥–∞–Ω–µ</h1>
            <p class="subtitle">–ü—Ä–µ—Å–º—è—Ç–∞–π —á–∏—Å–ª–∞—Ç–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ</p>
            
            <div class="config-group">
                <label>–ë—Ä–æ–π —Ü–∏—Ñ—Ä–∏:</label>
                <div class="config-buttons">
                    <button class="config-btn digits-btn" data-digits="2">2</button>
                    <button class="config-btn digits-btn" data-digits="3">3</button>
                    <button class="config-btn digits-btn" data-digits="4">4</button>
                    <button class="config-btn digits-btn" data-digits="5">5</button>
                </div>
            </div>
            
            <div class="config-group">
                <label>–ë—Ä–æ–π –∑–∞–¥–∞—á–∏:</label>
                <div class="config-buttons">
                    <button class="config-btn questions-btn" data-questions="10">10</button>
                    <button class="config-btn questions-btn" data-questions="20">20</button>
                    <button class="config-btn questions-btn" data-questions="30">30</button>
                    <button class="config-btn questions-btn" data-questions="50">50</button>
                </div>
            </div>
            
            <div class="config-group">
                <label>–û–ø–µ—Ä–∞—Ü–∏–∏:</label>
                <div class="config-buttons">
                    <button class="config-btn operation-btn" data-operation="addition">‚ûï –°—ä–±–∏—Ä–∞–Ω–µ</button>
                    <button class="config-btn operation-btn" data-operation="subtraction">‚ûñ –ò–∑–≤–∞–∂–¥–∞–Ω–µ</button>
                </div>
            </div>
            
            <div class="difficulty-group">
                <label>–°–ª–æ–∂–Ω–æ—Å—Ç:</label>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn" data-difficulty="easy">
                        <span class="diff-name">–õ–ï–°–ù–û</span>
                        <span class="diff-time" id="easyTimeLabel">18 —Å–µ–∫</span>
                    </button>
                    <button class="difficulty-btn" data-difficulty="medium">
                        <span class="diff-name">–°–†–ï–î–ù–û</span>
                        <span class="diff-time" id="mediumTimeLabel">12 —Å–µ–∫</span>
                    </button>
                    <button class="difficulty-btn" data-difficulty="hard">
                        <span class="diff-name">–¢–†–£–î–ù–û</span>
                        <span class="diff-time" id="hardTimeLabel">6 —Å–µ–∫</span>
                    </button>
                </div>
            </div>
            <button id="startSubtractionBtn" class="big-btn">–ó–∞–ø–æ—á–Ω–∏ –∏–≥—Ä–∞—Ç–∞!</button>
            <button id="viewSubtractionLeaderboardBtn" class="big-btn secondary-btn">üèÜ Leaderboard</button>
            <button class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="rules">
                <h3>üìú –ü—Ä–∞–≤–∏–ª–∞:</h3>
                <ul>
                    <li>–ò–∑–±–µ—Ä–∏ –±—Ä–æ–π –∑–∞–¥–∞—á–∏ (10-50)</li>
                    <li>–ò–∑–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ —Ü–∏—Ñ—Ä–∏ –∑–∞ –≤—Å—è–∫–∞ –ø–æ–∑–∏—Ü–∏—è</li>
                    <li>–û—Ç–±–µ–ª–µ–∂–∏ –¥–∞–ª–∏ –∏–º–∞ –ø—Ä–µ–Ω–∞—Å—è–Ω–µ/–∑–∞–µ–º</li>
                    <li>–í—Å—è–∫–∞ –∑–∞–¥–∞—á–∞: –º–∞–∫—Å 10 —Ç–æ—á–∫–∏</li>
                    <li>–ö–æ–ª–∫–æ—Ç–æ –ø–æ-–±—ä—Ä–∑–æ –æ—Ç–≥–æ–≤–æ—Ä–∏—à, —Ç–æ–ª–∫–æ–≤–∞ –ø–æ–≤–µ—á–µ —Ç–æ—á–∫–∏!</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Subtraction Game Screen -->
    <div id="subtractionGameScreen" class="screen hidden">
        <div class="game-container">
            <div class="question-card">
                <div class="header-progress">
                    <div class="progress-section">
                        <div class="progress-label">–ó–∞–¥–∞—á–∏: <span id="subQuestionNum">1</span>/<span id="subTotalQuestions">20</span></div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar tasks-bar" id="subTasksBar"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">–¢–æ—á–∫–∏: <span id="subCurrentScore">0</span>/<span id="subMaxScore">200</span></div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar points-possible-bar" id="subPointsPossibleBar"></div>
                            <div class="progress-bar points-earned-bar" id="subPointsEarnedBar"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label-inline">
                            <span>–í—Ä–µ–º–µ –∑–∞ –∑–∞–¥–∞—á–∞:</span>
                            <span class="question-points-label" id="subQuestionPointsLabel">10—Ç</span>
                        </div>
                        <div class="progress-bar-wrapper">
                            <div class="progress-bar question-progress-bar" id="subQuestionProgressBar"></div>
                        </div>
                    </div>
                </div>
                
                <div class="timer-display">–û–±—â–æ –≤—Ä–µ–º–µ: <span id="subGameTime">0:00</span></div>
                
                <!-- Vertical Subtraction Display -->
                <div class="subtraction-problem">
                    <div class="sub-row carry-row">
                        <div class="sub-cell empty"></div>
                        <div class="sub-cell">
                            <button class="carry-toggle" id="carryToggle"></button>
                        </div>
                        <div class="sub-cell empty"></div>
                    </div>
                    <div class="sub-row">
                        <div class="sub-cell empty"></div>
                        <div class="sub-cell digit" id="num1Tens">5</div>
                        <div class="sub-cell digit" id="num1Ones">5</div>
                    </div>
                    <div class="sub-row operator-row">
                        <div class="sub-cell operator">‚àí</div>
                        <div class="sub-cell empty"></div>
                        <div class="sub-cell empty"></div>
                    </div>
                    <div class="sub-row">
                        <div class="sub-cell empty"></div>
                        <div class="sub-cell digit" id="num2Tens">3</div>
                        <div class="sub-cell digit" id="num2Ones">7</div>
                    </div>
                    <div class="sub-row divider-row">
                        <div class="sub-cell"></div>
                        <div class="sub-cell"></div>
                        <div class="sub-cell"></div>
                    </div>
                    <div class="sub-row answer-row">
                        <div class="sub-cell empty"></div>
                        <div class="sub-cell answer-cell" id="answerTens" data-position="tens">
                        </div>
                        <div class="sub-cell answer-cell" id="answerOnes" data-position="ones">
                        </div>
                    </div>
                </div>
                
                <!-- Number Pad -->
                <div class="number-pad">
                    <button class="num-btn" data-num="0">0</button>
                    <button class="num-btn" data-num="1">1</button>
                    <button class="num-btn" data-num="2">2</button>
                    <button class="num-btn" data-num="3">3</button>
                    <button class="num-btn" data-num="4">4</button>
                    <button class="num-btn" data-num="5">5</button>
                    <button class="num-btn" data-num="6">6</button>
                    <button class="num-btn" data-num="7">7</button>
                    <button class="num-btn" data-num="8">8</button>
                    <button class="num-btn" data-num="9">9</button>
                </div>
                
                <button id="subContinueBtn" class="big-btn">–ü—Ä–æ–¥—ä–ª–∂–∏</button>
            </div>
            <div class="feedback hidden" id="subFeedback"></div>
        </div>
    </div>

    <!-- Subtraction Results Screen -->
    <div id="subtractionResultsScreen" class="screen hidden">
        <div class="container">
            <h1>üéâ –ë—Ä–∞–≤–æ!</h1>
            <div class="final-results">
                <div class="stat-box">
                    <div class="stat-label">–§–∏–Ω–∞–ª–Ω–∏ —Ç–æ—á–∫–∏</div>
                    <div class="stat-value" id="subFinalScore">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">–í—Ä–µ–º–µ</div>
                    <div class="stat-value" id="subFinalTime">0:00</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">–¢–æ—á–∫–∏/–º–∏–Ω—É—Ç–∞</div>
                    <div class="stat-value" id="subScorePerMinute">0</div>
                </div>
            </div>
            
            <div class="leaderboard">
                <h2>üèÜ –ö–ª–∞—Å–∞—Ü–∏—è - <span id="subLeaderboardDifficulty"></span></h2>
                <div id="subLeaderboardList"></div>
            </div>
            
            <button id="subtractionPlayAgainBtn" class="big-btn">–ò–≥—Ä–∞–π –æ—Ç–Ω–æ–≤–æ!</button>
            <button id="subtractionBackToSetupBtn" class="big-btn secondary-btn">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="back-btn">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º –∏–≥—Ä–∏</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration (optional - falls back to localStorage if missing) -->
    <script src="firebase-config.js"></script>
    
    <!-- Firebase Service -->
    <script src="firebase-service.js"></script>
    
    <!-- Game Modules (must be loaded in this order before app.js) -->
    <script src="js/group-manager.js"></script>
    <script src="js/game-manager.js"></script>
    <script src="js/division-game.js"></script>
    <script src="js/subtraction-game.js"></script>
    
    <!-- Main App (initialization only) -->
    <script src="app.js"></script>
</body>
</html>
